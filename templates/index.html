<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parc Ast√©rix - Temps d'attente</title>
    <!-- Ajout des m√©ta-tags pour am√©liorer le chargement -->
    <meta http-equiv="Cache-Control" content="max-age=300">
    <meta name="description" content="Temps d'attente en direct pour les attractions du Parc Ast√©rix">
    <style>
        /* CSS minifi√© et optimis√© */
        body{font-family:system-ui,-apple-system,sans-serif;line-height:1.5;color:#333;max-width:800px;margin:0 auto;padding:15px;background-color:#f5f5f5}
        header{text-align:center;margin-bottom:20px;border-bottom:2px solid #e74c3c;padding-bottom:10px}
        h1{color:#e74c3c;margin-bottom:5px;font-size:1.8rem}
        h2{margin-top:0;color:#e74c3c;border-bottom:1px solid #eee;padding-bottom:8px;font-size:1.4rem}
        .update-info{background-color:#f8f9fa;border-left:4px solid #e74c3c;padding:10px;margin-bottom:15px;font-size:.9em}
        .category{background-color:#fff;border-radius:8px;padding:12px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
        .description{font-style:italic;margin-bottom:12px;color:#666}
        ul{list-style-type:none;padding:0;margin:0}
        li{padding:6px 0;border-bottom:1px solid #eee}
        .open{color:#27ae60;font-weight:700}
        .closed{color:#c0392b}
        .wait-time{font-weight:700;margin-left:8px}
        footer{text-align:center;margin-top:25px;font-size:.8em;color:#777;border-top:1px solid #eee;padding-top:15px}
        .warning{background-color:#fcf8e3;border-left:4px solid #f39c12;padding:10px;margin:12px 0;font-size:.9em}
        .refresh-button{display:block;width:100%;padding:10px;background-color:#e74c3c;color:#fff;border:none;border-radius:4px;font-size:16px;cursor:pointer;margin:15px 0}
        .refresh-button:hover{background-color:#c0392b}
        .startup-notice{display:none;position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px;border-radius:4px;font-size:.8em;max-width:250px;z-index:100}
        @media (max-width:600px){body{padding:8px}.category{padding:8px}}
    </style>
</head>
<body>
    <header>
        <h1>üé¢ Parc Ast√©rix - Temps d'attente</h1>
        <p>Consultez les temps d'attente en direct pour planifier votre visite</p>
    </header>
    
    <div class="update-info">
        <p>üìå Donn√©es mises √† jour le {{ last_updated }}</p>
        <p>‚ö†Ô∏è {{ freshness }} - PAS DE DONN√âES EN TEMPS R√âEL</p>
    </div>
    
    <button class="refresh-button" onclick="window.location.reload()">Rafra√Æchir les donn√©es</button>
    
    <section class="category">
        <h2>üé¢ SENSATIONS FORTES</h2>
        <p class="description">Ces attractions sont destin√©es aux amateurs de sensations intenses</p>
        <ul>
            {% for ride in sensations %}
                <li>
                    {% if ride.is_open %}
                        <span class="open">‚úÖ OUVERT</span>
                        <span class="wait-time">{{ ride.wait_time }} min</span>
                    {% else %}
                        <span class="closed">‚ùå FERM√â</span>
                    {% endif %}
                    - {{ ride.name }}
                </li>
            {% endfor %}
        </ul>
    </section>
    
    <section class="category">
        <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ATTRACTIONS FAMILIALES</h2>
        <p class="description">Ces attractions conviennent √† tous les √¢ges</p>
        <ul>
            {% for ride in familles %}
                <li>
                    {% if ride.is_open %}
                        <span class="open">‚úÖ OUVERT</span>
                        <span class="wait-time">{{ ride.wait_time }} min</span>
                    {% else %}
                        <span class="closed">‚ùå FERM√â</span>
                    {% endif %}
                    - {{ ride.name }}
                </li>
            {% endfor %}
        </ul>
    </section>
    
    <section class="category">
        <h2>üßí PETITS GAULOIS</h2>
        <p class="description">Ces attractions sont sp√©cialement con√ßues pour les plus jeunes visiteurs</p>
        <ul>
            {% for ride in enfants %}
                <li>
                    {% if ride.is_open %}
                        <span class="open">‚úÖ OUVERT</span>
                        <span class="wait-time">{{ ride.wait_time }} min</span>
                    {% else %}
                        <span class="closed">‚ùå FERM√â</span>
                    {% endif %}
                    - {{ ride.name }}
                </li>
            {% endfor %}
        </ul>
    </section>
    
    <section class="category">
        <h2>üèõÔ∏è AUTRES ATTRACTIONS</h2>
        <p class="description">Autres attractions et exp√©riences du parc</p>
        <ul>
            {% for ride in autres %}
                <li>
                    {% if ride.is_open %}
                        <span class="open">‚úÖ OUVERT</span>
                        <span class="wait-time">{{ ride.wait_time }} min</span>
                    {% else %}
                        <span class="closed">‚ùå FERM√â</span>
                    {% endif %}
                    - {{ ride.name }}
                </li>
            {% endfor %}
        </ul>
    </section>
    
    <div class="warning">
        <p>‚ö†Ô∏è Les donn√©es sont mises √† jour p√©riodiquement par l'API Queue-Times.com et peuvent ne pas refl√©ter exactement la situation actuelle dans le parc.</p>
    </div>
    
    <footer>
        <p>Source des donn√©es: Queue-Times.com API</p>
        <p>¬© 2025 - Application non-officielle du Parc Ast√©rix</p>
    </footer>
    
    <div id="startup-notice" class="startup-notice">
        Application en cours de d√©marrage... Merci de patienter quelques secondes.
    </div>

    <script>
    // Script optimis√© pour g√©rer le red√©marrage √† froid et am√©liorer l'exp√©rience utilisateur
    (function() {
        // D√©tection du temps de chargement
        const startTime = performance.now();
        window.addEventListener('load', function() {
            const loadTime = performance.now() - startTime;
            // Si le chargement est lent (>2s), probablement un d√©marrage √† froid
            if (loadTime > 2000) {
                showStartupNotice();
            }
        });

        // Gestion du bouton de rafra√Æchissement
        document.querySelector('.refresh-button').addEventListener('click', function(e) {
            e.preventDefault();
            this.textContent = 'Rafra√Æchissement en cours...';
            this.disabled = true;
            // Utilisation de fetch pour v√©rifier si l'app est r√©veill√©e avant de rafra√Æchir
            fetch(window.location.href, { method: 'HEAD' })
                .then(() => window.location.reload())
                .catch(() => {
                    showStartupNotice();
                    setTimeout(() => window.location.reload(), 3000);
                });
        });

        // Affichage de la notification de d√©marrage
        function showStartupNotice() {
            const notice = document.getElementById('startup-notice');
            notice.style.display = 'block';
            setTimeout(() => {
                notice.style.display = 'none';
            }, 5000);
        }

        // Pr√©chargement des donn√©es pour le prochain acc√®s
        let lastActivity = Date.now();
        document.addEventListener('mousemove', updateActivity);
        document.addEventListener('keydown', updateActivity);
        document.addEventListener('scroll', updateActivity);
        document.addEventListener('click', updateActivity);

        function updateActivity() {
            lastActivity = Date.now();
        }

        // Ping l'application toutes les 10 minutes si l'utilisateur est actif
        // pour √©viter que l'app s'endorme apr√®s 15 minutes d'inactivit√©
        setInterval(function() {
            // V√©rifie si l'utilisateur a √©t√© actif dans les 5 derni√®res minutes
            if (Date.now() - lastActivity < 5 * 60 * 1000) {
                fetch(window.location.href, { method: 'HEAD' });
            }
        }, 10 * 60 * 1000); // 10 minutes
    })();
    </script>
</body>
</html>
